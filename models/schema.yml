version: 2

models:
  - name: fact_customer_revenue
    description: "Gold layer: Final customer revenue metrics."
    tests:
      - unique:
          column_name: customer_id
      - not_null:
          column_name: customer_id
      - not_null:
          column_name: revenue_amount
      - dbt_utils.expression_is_true:
          expression: "revenue_amount >= 0"
          description: "Ensures revenue amounts are not negative"
    columns:
      - name: customer_id
        description: "Unique identifier for each customer"
        tests:
          - relationships:
              to: ref('dim_customers')
              field: customer_id
      - name: revenue_amount
        description: "Total revenue generated by the customer"
        tests:
          - statistical_range:
              min_value: 0
              max_value: 1000000
      - name: transaction_date
        description: "Date of the revenue transaction"
        tests:
          - not_null
          - dbt_utils.date_in_valid_range:
              start_date: '2010-01-01'
              end_date: 'current_date'